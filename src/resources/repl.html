<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
    <!-- <script type="text/javascript" src="lib/js/json2.js"></script> -->
    <script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="lib/bolt/kernel.js"></script>
    <script type="text/javascript" src="lib/bolt/loader.js"></script>
    <script type="text/javascript" src="lib/bolt/module.js"></script>
    <script type="text/javascript">
      console.log('REPL loading ...');


      // var runtest =  function (next, wrapper, testfile, name, replacements, deps, fn) {
      //   var enriched = config.enricher(reader, testfile, replacements);
      //   if (ephox.bolt.module.runtime.define === undefined) {
      //     console.log('installing runtime', enriched, builtins, load, loadscript);
      //     install.install(enriched, builtins, load, loadscript);
      //   } else {
      //     enriched(function () { });
      //   }
      //   var wrapped = wrapper(reporter, testfile, name, fn, next);
      //   console.log('wrapper', deps);
      //   ephox.bolt.module.api.require(deps, wrapped);
      // };

      // var bomb = function (e) {
      //   $('body').append('<div class="failed done">ajax error: ' + JSON.stringify(e) + '</div>');
      // };

      // api.loadtests = function (data) {
      //   testconfig = data.config;  // intentional, see top of file for var decl.
      //   var scripts = data.scripts;
      //   reporter.setStopOnFailure(data.stopOnFailure);
      //   var loop = function () {
      //     if (scripts.length > 0) {
      //       var testfile = 'project/' + scripts.shift();
      //       accumulator.register(testfile, wrapper.sync, wrapper.async);
      //       loadscript(testfile, loop, bomb);
      //     } else {
      //       testcount.text(accumulator.length()); // intentional, see top of file for var decl.
      //       accumulator.drain(runtest, reporter.done);
      //     }
      //   };
      //   loop();
      // };


      $.ajax({
        url: 'repl',
        dataType: 'json',
        success: function (response) {
          console.log('REPL loaded ...');


          var install = ephox.bolt.module.bootstrap.install;
          var builtins = ephox.bolt.module.config.builtins.browser;
          var load = ephox.bolt.loader.transporter.xhr.request;
          var loadscript = ephox.bolt.loader.api.scripttag.load;

          var reader = function (done) {
            ephox.bolt.module.reader.browser.read('./', 'project/' + response.config, done);
          };

          install.install(reader, builtins, load, loadscript);

          var global = Function('return this;')();

          global.define = ephox.bolt.module.api.define;
          global.require = ephox.bolt.module.api.require;
          global.demand = ephox.bolt.module.api.demand;

            console.log('here');
          // })

          // $.getScript(response.config, function () {

          //   console.log('REPL active', response.repl, response);
          //   ephox.bolt.module.api.require([ 'ephox.gopher.api.Component' ], function (Component) {
          //     console.log('Component', Component);
          //   });
          // });
        },
        error: function (err ) {
          console.error('REPL failed', err);
          throw new Error(err);
        }
      });
    </script>

    <title>REPL</title>
</head>
<body>
    <h1>REPL</h1>
</body>
</html>